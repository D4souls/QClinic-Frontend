<div class="grid grid-cols-2 grid-flow-row gap-8 p-6">
  <div class="col-span-1 row-span-1 w-full flex flex-col gap-4 justify-center">
    <h3 class="self-start font-bold text-md md:text-2xl dark:text-white/90">
      My profile
    </h3>

    <div
      class="flex flex-row gap-4 p-4 rounded-md focus:scale-105 transition-all ease-in-out bg-white/90 dark:bg-gray-800 relative"
    >
      <div class="flex flex-row self-start gap-4">
        <img
          src="http://localhost:8080/doctors/avatar/{{ doctorInfo.dni }}.jpg"
          alt="doctor-avatar"
          class="rounded-md w-20 h-20"
        />
        <div class="flex flex-col gap-2 justify-center items-start">
          <span class="text-2xl dark:text-white/90"
            >{{ doctorInfo.firstname }} {{ doctorInfo.lastname }}</span
          >

          <div
            class="flex flex-row gap-3 justify-center items-center dark:text-white/90"
          >
            <span
              class="bg-purple-100 text-purple-800 text-xs font-medium me-2 px-2.5 py-0.5 rounded dark:bg-purple-900 dark:text-purple-300 inline-flex items-center gap-2"
              >
              <svg class="w-6 h-6 text-gray-800 dark:text-white" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 24 24">
                <path fill-rule="evenodd" d="M4 4a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V6a2 2 0 0 0-2-2H4Zm10 5a1 1 0 0 1 1-1h3a1 1 0 1 1 0 2h-3a1 1 0 0 1-1-1Zm0 3a1 1 0 0 1 1-1h3a1 1 0 1 1 0 2h-3a1 1 0 0 1-1-1Zm0 3a1 1 0 0 1 1-1h3a1 1 0 1 1 0 2h-3a1 1 0 0 1-1-1Zm-8-5a3 3 0 1 1 6 0 3 3 0 0 1-6 0Zm1.942 4a3 3 0 0 0-2.847 2.051l-.044.133-.004.012c-.042.126-.055.167-.042.195.006.013.02.023.038.039.032.025.08.064.146.155A1 1 0 0 0 6 17h6a1 1 0 0 0 .811-.415.713.713 0 0 1 .146-.155c.019-.016.031-.026.038-.04.014-.027 0-.068-.042-.194l-.004-.012-.044-.133A3 3 0 0 0 10.059 14H7.942Z" clip-rule="evenodd"/>
              </svg>
              
              {{ doctorSpecialization.name }}
              </span
            >
            <span
              class="bg-gray-100 text-gray-800 text-xs font-medium me-2 px-2.5 py-0.5 rounded dark:bg-gray-700 dark:text-gray-300 inline-flex items-center gap-2"
              >
              <svg class="w-6 h-6 text-gray-800 dark:text-white" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24">
                <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z"/>
              </svg>              
              {{ doctorSchedule.scheduleStart | formatTimes }} -
              {{ doctorSchedule.scheduleEnd | formatTimes }}
              </span
            >
          </div>
        </div>

        <button
          type="button"
          (click)="openModal(null, 'modal-edit-user')"
          class="absolute right-4 flex justify-center items-center bg-gray-400/40 hover:bg-gray-500/60 py-2 px-2.5 rounded-xl transition ease-in-out"
        >
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="24"
            height="24"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
            class="dark:text-white/90 icon icon-tabler icons-tabler-outline icon-tabler-settings"
          >
            <path stroke="none" d="M0 0h24v24H0z" fill="none" />
            <path
              d="M10.325 4.317c.426 -1.756 2.924 -1.756 3.35 0a1.724 1.724 0 0 0 2.573 1.066c1.543 -.94 3.31 .826 2.37 2.37a1.724 1.724 0 0 0 1.065 2.572c1.756 .426 1.756 2.924 0 3.35a1.724 1.724 0 0 0 -1.066 2.573c.94 1.543 -.826 3.31 -2.37 2.37a1.724 1.724 0 0 0 -2.572 1.065c-.426 1.756 -2.924 1.756 -3.35 0a1.724 1.724 0 0 0 -2.573 -1.066c-1.543 .94 -3.31 -.826 -2.37 -2.37a1.724 1.724 0 0 0 -1.065 -2.572c-1.756 -.426 -1.756 -2.924 0 -3.35a1.724 1.724 0 0 0 1.066 -2.573c-.94 -1.543 .826 -3.31 2.37 -2.37c1 .608 2.296 .07 2.572 -1.065z"
            />
            <path d="M9 12a3 3 0 1 0 6 0a3 3 0 0 0 -6 0" />
          </svg>
        </button>
      </div>
    </div>
  </div>

  <div class="col-span-2 flex flex-row justify-end items-center gap-4">
    @if (doctorStadistics.length > 0) {
    <div
      class="bg-white/90 w-full rounded-md p-4 bg-white dark:bg-gray-800 dark:border-gray-700 dark:hover:bg-gray-600 hover:scale-105 transition-all ease-in-out"
    >
      <div class="flex flex-col justify-center items-start ml-8 relative">
        <h2 class="dark:text-white/90 font-semibold text-base">Appointments</h2>
        <span class="dark:text-white/90 text-lg font-normal">{{
          doctorStadistics[0].totalAppointments
        }}</span>
        <span class="dark:text-white/90 text-xs text-gray-600"
          >{{ doctorStadistics[0].paidAppointments }} payed |
          {{ doctorStadistics[0].unpaidAppointments }} unpayed</span
        >

        @if ( doctorStadistics[0].paidAppointments ){
        <svg
          class="absolute bottom-0 -left-7 icon icon-tabler icons-tabler-outline icon-tabler-trending-up"
          xmlns="http://www.w3.org/2000/svg"
          width="20"
          height="20"
          viewBox="0 0 24 24"
          fill="none"
          stroke="#1DAA39"
          stroke-width="2"
          stroke-linecap="round"
          stroke-linejoin="round"
        >
          <path stroke="none" d="M0 0h24v24H0z" fill="none" />
          <path d="M3 17l6 -6l4 4l8 -8" />
          <path d="M14 7l7 0l0 7" />
        </svg>
        } @else {
        <svg
          xmlns="http://www.w3.org/2000/svg"
          width="20"
          height="20"
          viewBox="0 0 24 24"
          fill="none"
          stroke="#AF2929"
          stroke-width="2"
          stroke-linecap="round"
          stroke-linejoin="round"
          class="absolute bottom-0 -left-7 icon icon-tabler icons-tabler-outline icon-tabler-trending-down"
        >
          <path stroke="none" d="M0 0h24v24H0z" fill="none" />
          <path d="M3 7l6 6l4 -4l8 8" />
          <path d="M21 10l0 7l-7 0" />
        </svg>
        }
      </div>
    </div>

    <div
      class="bg-white/90 w-full rounded-md p-4 bg-white dark:bg-gray-800 dark:border-gray-700 dark:hover:bg-gray-600 hover:scale-105 transition-all ease-in-out"
    >
      <div
        class="flex flex-col flex-wrap flex-shrink justify-center items-start ml-8 relative"
      >
        <h2 class="dark:text-white/90 font-semibold text-base">Patients</h2>
        <span class="dark:text-white/90 text-base font-normal">{{
          doctorStadistics[0].totalPatients
        }}</span>
        <span class="dark:text-white/90 text-xs text-gray-600"
          >{{ doctorStadistics[0].newPatients }} new</span
        >

        @if ( doctorStadistics[0].newPatients > 0 ){
        <svg
          class="absolute bottom-0 -left-7 icon icon-tabler icons-tabler-outline icon-tabler-trending-up"
          xmlns="http://www.w3.org/2000/svg"
          width="20"
          height="20"
          viewBox="0 0 24 24"
          fill="none"
          stroke="#1DAA39"
          stroke-width="2"
          stroke-linecap="round"
          stroke-linejoin="round"
        >
          <path stroke="none" d="M0 0h24v24H0z" fill="none" />
          <path d="M3 17l6 -6l4 4l8 -8" />
          <path d="M14 7l7 0l0 7" />
        </svg>
        } @else {
        <svg
          xmlns="http://www.w3.org/2000/svg"
          width="20"
          height="20"
          viewBox="0 0 24 24"
          fill="none"
          stroke="#AF2929"
          stroke-width="2"
          stroke-linecap="round"
          stroke-linejoin="round"
          class="absolute bottom-0 -left-7 icon icon-tabler icons-tabler-outline icon-tabler-trending-down"
        >
          <path stroke="none" d="M0 0h24v24H0z" fill="none" />
          <path d="M3 7l6 6l4 -4l8 8" />
          <path d="M21 10l0 7l-7 0" />
        </svg>
        }
      </div>
    </div>
    }
  </div>

  <div class="col-span-2 flex flex-col gap-2">
    <h3 class="self-start font-bold text-md md:text-2xl dark:text-white/90">
      Next appointments
    </h3>

    @if(appointmentsDay().length > 0){
    <table
      class="w-full text-sm text-left table-auto rtl:text-right text-gray-500 dark:text-gray-400"
    >
      <thead
        class="table-header-group text-xs text-gray-700 uppercase bg-gray-50 dark:bg-gray-700 dark:text-gray-400"
      >
        <tr class="table-row">
          <th scope="col" class="p-4">
            <span class="sr-only">Avatar</span>
          </th>
          <th scope="col" class="px-6 py-3 table-cell">Patient</th>
          <th scope="col" class="px-6 py-3 table-cell">Patient phone</th>
          <th scope="col" class="px-6 py-3 md:table-cell hidden">Date</th>
          <th scope="col" class="px-6 py-3 md:table-cell hidden">Doctor</th>
          <th scope="col" class="p-4">
            <span class="sr-only">Payed</span>
          </th>
        </tr>
      </thead>
      <tbody class="table-row-group">
        @for (appointment of appointmentsDay(); track appointmentsDay().dni){
        <tr
          class="table-row bg-white border-b dark:bg-gray-800 dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-600"
        >
          <td>
            <div class="flex -space-x-2 rtl:space-x-reverse">
              <div class="relative z-10">
                <img
                  class="w-9 h-9 border-2 border-white rounded-lg dark:border-gray-800"
                  src="http://localhost:8080/patients/avatar/{{
                    appointment.patientInfo.dni
                  }}.jpg"
                  alt=""
                />
                <span
                  class="top-0 left-7 absolute w-3.5 h-3.5 {{
                    appointment.patientInfo.isActive
                      ? 'bg-green-400'
                      : 'bg-red-400'
                  }} border-2 border-white dark:border-gray-800 rounded-full"
                ></span>
              </div>
              <div class="relative">
                <img
                  class="w-9 h-9 border-2 border-white rounded-lg dark:border-gray-800"
                  src="http://localhost:8080/doctors/avatar/{{
                    appointment.doctorInfo.dni
                  }}.jpg"
                  alt=""
                />
                <span
                  class="top-0 left-7 absolute w-3.5 h-3.5 {{
                    appointment.doctorInfo.isActive
                      ? 'bg-green-400'
                      : 'bg-red-400'
                  }} border-2 border-white dark:border-gray-800 rounded-full"
                ></span>
              </div>
            </div>
          </td>
          <th
            scope="row"
            class="px-6 py-4 font-medium text-gray-900 whitespace-nowrap dark:text-white"
          >
            {{ appointment.patientInfo.firstname }}
            {{ appointment.patientInfo.lastname }}
          </th>

          <td class="px-6 py-4 md:table-cell hidden">
            {{ appointment.patientInfo.phone }}
          </td>

          <td class="px-6 py-4 md:table-cell hidden">
            {{
              appointment.appointmentInfo.appointmentStart
                | date : "dd/MM/yyyy h:mm a"
            }}
          </td>

          <td class="px-6 py-4 md:table-cell hidden">
            {{ appointment.doctorInfo.firstname }}
            {{ appointment.doctorInfo.lastname }}
          </td>

          <td
            class="px-6 py-4 cursor-pointer"
            (click)="
              openModal(
                appointment.appointmentInfo.id,
                'modal-start-appointment'
              )
            "
          >
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="24"
              height="24"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
              class="icon icon-tabler icons-tabler-outline icon-tabler-player-play"
            >
              <path stroke="none" d="M0 0h24v24H0z" fill="none" />
              <path d="M7 4v16l13 -8z" />
            </svg>
          </td>
        </tr>
        }
      </tbody>
    </table>
    } @else {
    <div class="flex flex-row items-center justify-center mt-[10%]">
      <img
        src="/assets/images/calendar-flatline.png"
        alt="earch-engine"
        width="150"
      />
      <span class="text-gray-500">We didn't find any appointments</span>
    </div>
    }
  </div>
</div>

<!-- MODALS -->
<div
  id="modal-start-appointment"
  tabindex="-1"
  aria-hidden="true"
  class="hidden overflow-y-auto overflow-x-hidden fixed top-0 right-0 left-0 z-50 justify-center items-center w-full md:inset-0 h-[calc(100%-1rem)] max-h-full"
>
  <div class="relative p-4 w-full max-w-md max-h-full">
    <!-- Modal content -->
    <div class="relative bg-white rounded-lg shadow dark:bg-dark-main-bg">
      <!-- Modal header -->
      <div
        class="flex items-center justify-between p-4 md:p-5 border-b rounded-t dark:border-gray-600"
      >
        <h3 class="text-lg font-semibold text-gray-900 dark:text-white">
          Appointment started
        </h3>
        <button
          type="button"
          (click)="returnBack('modal-start-appointment')"
          class="text-gray-400 bg-transparent hover:bg-gray-200 hover:text-gray-900 rounded-lg text-sm w-8 h-8 ms-auto inline-flex justify-center items-center dark:hover:bg-gray-600 dark:hover:text-white"
        >
          <svg
            class="w-3 h-3"
            aria-hidden="true"
            xmlns="http://www.w3.org/2000/svg"
            fill="none"
            viewBox="0 0 14 14"
          >
            <path
              stroke="currentColor"
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="m1 1 6 6m0 0 6 6M7 7l6-6M7 7l-6 6"
            />
          </svg>
          <span class="sr-only">Close modal</span>
        </button>
      </div>
      <!-- Modal body -->
      <form class="p-4 md:p-5">
        <div class="grid gap-4 mb-4 grid-cols-2">
          <div class="col-span-2">
            <label
              for="description"
              class="block mb-2 text-sm font-medium text-gray-900 dark:text-white"
              >Comments</label
            >
            <textarea
              id="commentAppointment"
              rows="4"
              class="block p-2.5 w-full text-sm text-gray-900 bg-gray-50 rounded-lg border border-gray-300 focus:ring-main-purple focus:border-main-purple dark:bg-gray-600 dark:border-gray-500 dark:placeholder-gray-400 dark:text-white dark:focus:ring-main-purple dark:focus:border-main-purple"
              placeholder="Write comments here"
            ></textarea>
          </div>
        </div>
        <button
          type="button"
          (click)="updateAppointment()"
          class="inline-flex justify-center items-center gap-2 focus:outline-none text-white focus:ring-4 focus:ring-purple-300 font-medium rounded-lg text-sm px-5 py-2.5 mb-2 bg-main-purple dark:bg-gray-700 cursor-pointer"
        >
          <svg
            class="w-6 h-6 text-white"
            aria-hidden="true"
            xmlns="http://www.w3.org/2000/svg"
            width="24"
            height="24"
            fill="none"
            viewBox="0 0 24 24"
          >
            <rect
              width="12"
              height="12"
              x="6"
              y="6"
              stroke="currentColor"
              stroke-linejoin="round"
              stroke-width="2"
              rx="1"
            />
          </svg>
          End
        </button>
      </form>
    </div>
  </div>
</div>

<div
  id="modal-edit-user"
  tabindex="-1"
  aria-hidden="true"
  class="hidden overflow-y-auto overflow-x-hidden fixed top-0 right-0 left-0 z-50 justify-center items-center w-full md:inset-0 h-[calc(100%-1rem)] max-h-full"
>
  <div class="relative p-4 w-full max-w-md max-h-full">
    <!-- Modal content -->
    <div class="relative bg-white rounded-lg shadow dark:bg-dark-main-bg">
      <!-- Modal header -->
      <div
        class="flex items-center justify-between p-4 md:p-5 border-b rounded-t dark:border-gray-600"
      >
        <h3 class="text-lg font-semibold text-gray-900 dark:text-white">
          Update credentials
        </h3>
        <button
          type="button"
          (click)="returnBack('modal-edit-user')"
          class="text-gray-400 bg-transparent hover:bg-gray-200 hover:text-gray-900 rounded-lg text-sm w-8 h-8 ms-auto inline-flex justify-center items-center dark:hover:bg-gray-600 dark:hover:text-white"
        >
          <svg
            class="w-3 h-3"
            aria-hidden="true"
            xmlns="http://www.w3.org/2000/svg"
            fill="none"
            viewBox="0 0 14 14"
          >
            <path
              stroke="currentColor"
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="m1 1 6 6m0 0 6 6M7 7l6-6M7 7l-6 6"
            />
          </svg>
          <span class="sr-only">Close modal</span>
        </button>
      </div>
      <!-- Modal body -->
      <form class="p-4 md:p-5">
        <form class="grid gap-2 mb-4 grid-cols-2" [formGroup]="userWebForm">
          <div class="col-span-2">
            <label
              for="user"
              class="flex flex-row items-center px-2 border border-gray-400/40 dark:bg-gray-700 dark:text-white/90 rounded-md focus:ring-main-purple/80 focus:border-main-purple/80 dark:focus:ring-gray-400 dark:focus:border-gray-400"
            >
              <svg
                xmlns="http://www.w3.org/2000/svg"
                fill="none"
                viewBox="0 0 24 24"
                stroke-width="1.5"
                stroke="currentColor"
                class="w-6 h-6"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  d="M17.982 18.725A7.488 7.488 0 0 0 12 15.75a7.488 7.488 0 0 0-5.982 2.975m11.963 0a9 9 0 1 0-11.963 0m11.963 0A8.966 8.966 0 0 1 12 21a8.966 8.966 0 0 1-5.982-2.275M15 9.75a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z"
                />
              </svg>

              <input
                id="user"
                type="text"
                formControlName="username"
                placeholder="Username"
                class="border-none focus:ring-0 w-full dark:bg-gray-700"
              />
            </label>
          </div>

          <div class="col-span-2">
            <label
              for="passwd"
              class="relative flex flex-row items-center px-2 border border-gray-400/40 dark:bg-gray-700 dark:text-white/90 rounded-md focus:ring-main-purple/80 focus:border-main-purple/80 dark:focus:ring-gray-400 dark:focus:border-gray-400"
            >
              <svg
                xmlns="http://www.w3.org/2000/svg"
                fill="none"
                viewBox="0 0 24 24"
                stroke-width="1.5"
                stroke="currentColor"
                class="w-6 h-6"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  d="M16.5 10.5V6.75a4.5 4.5 0 1 0-9 0v3.75m-.75 11.25h10.5a2.25 2.25 0 0 0 2.25-2.25v-6.75a2.25 2.25 0 0 0-2.25-2.25H6.75a2.25 2.25 0 0 0-2.25 2.25v6.75a2.25 2.25 0 0 0 2.25 2.25Z"
                />
              </svg>

              <input
                id="passwd"
                type="password"
                formControlName="password"
                placeholder="Password"
                class="border-none focus:ring-0 w-full dark:bg-gray-700"
              />

              <button
                type="button"
                (click)="showPassword()"
                class="absolute right-2 cursor-pointer opacity-100"
              >
                <svg
                  id="closeEye"
                  xmlns="http://www.w3.org/2000/svg"
                  fill="none"
                  viewBox="0 0 24 24"
                  stroke-width="1.5"
                  stroke="currentColor"
                  class="w-5 h-5 animate-pop"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    d="M3.98 8.223A10.477 10.477 0 0 0 1.934 12C3.226 16.338 7.244 19.5 12 19.5c.993 0 1.953-.138 2.863-.395M6.228 6.228A10.451 10.451 0 0 1 12 4.5c4.756 0 8.773 3.162 10.065 7.498a10.522 10.522 0 0 1-4.293 5.774M6.228 6.228 3 3m3.228 3.228 3.65 3.65m7.894 7.894L21 21m-3.228-3.228-3.65-3.65m0 0a3 3 0 1 0-4.243-4.243m4.242 4.242L9.88 9.88"
                  />
                </svg>

                <svg
                  id="openEye"
                  xmlns="http://www.w3.org/2000/svg"
                  fill="none"
                  viewBox="0 0 24 24"
                  stroke-width="1.5"
                  stroke="currentColor"
                  class="w-5 h-5"
                  style="display: none"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    d="M2.036 12.322a1.012 1.012 0 0 1 0-.639C3.423 7.51 7.36 4.5 12 4.5c4.638 0 8.573 3.007 9.963 7.178.07.207.07.431 0 .639C20.577 16.49 16.64 19.5 12 19.5c-4.638 0-8.573-3.007-9.963-7.178Z"
                  />
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    d="M15 12a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z"
                  />
                </svg>
              </button>
            </label>
          </div>
        </form>
        <button
          type="button"
          (click)="updateCredentials()"
          [disabled]="!userWebForm.valid"
          class="{{
            !userWebForm.valid
              ? 'cursor-not-allowed opacity-70'
              : 'cursor-pointer'
          }}inline-flex justify-center items-center gap-2 focus:outline-none text-white focus:ring-4 focus:ring-purple-300 font-medium rounded-lg text-sm px-5 py-2.5 mb-2 bg-main-purple dark:bg-gray-700 cursor-pointer"
        >
          Update
        </button>
      </form>
    </div>
  </div>
</div>
